function process_sentence(t,e,n,r){var a=0,s=0,o=[];for(i=0;i<t.length;i++){var l=t[i],c=l.length,d=n[i];o.push({start:a,len:c+1,languageindex:e,word:l,xstart:s,xend:s+d}),a+=c+1,s+=d+r}return[o,a]}function preprocess(t,e,n){var r={};for(re=process_sentence(t.e,0,e.e,n),r.nodes_e=re[0],rf=process_sentence(t.f,1,e.f,n),r.nodes_f=rf[0],r.max_chars=Math.max(re[1],rf[1]),r.links=[],i=0;i<t.alignment.length;i++)r.links.push({source:t.alignment[i][0],target:t.alignment[i][1]});return r}function drawnodes(t,e,n,r,a){e=t.selectAll("node").data(e).enter().append("text").attr("x",function(t){return t.xstart+a}).attr("y",function(t){return n}).text(function(t){return t.word}).attr("fill","black").attr("font-size",r)}function drawlinks(t,e,n,r,a,s,i,o){t.selectAll("link").data(e.links).enter().append("line").attr("class","link").attr("x1",function(t){var r=e.nodes_e.filter(function(e,n){return n==t.source})[0];return d3.select(this).attr("y1",n+a),.5*r.xstart+.5*r.xend+i}).attr("x2",function(t){var n=e.nodes_f.filter(function(e,n){return n==t.target})[0];return d3.select(this).attr("y2",r-s),.5*n.xstart+.5*n.xend+i}).attr("fill","none").attr("stroke","#00A30B").attr("stroke-width",o)}function get_lengths(t,e,n){return widths=[],t.append("g").selectAll(".dummyText").data(e).enter().append("text").attr("fill","black").attr("font-size",n).text(function(t){return t}).each(function(t,e){var n=this.getComputedTextLength();widths.push(n),this.remove()}),widths}function get_sentence_length(t,e){return t.reduce((t,e)=>t+e,0)+t.length*e}function compute_lengths(t,e,n,r){var a={};return a.e=get_lengths(t,e.e,n),a.f=get_lengths(t,e.f,n),a.etotal=get_sentence_length(a.e,r),a.ftotal=get_sentence_length(a.f,r),a.maxreq=Math.max(a.etotal,a.ftotal),a}function drawit(t){var e=12,n=5,r=8,a=5,s=1.5,i=d3.select("#alignment").append("div").classed("svg-container",!0).attr("id","my-svg-container").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 75").classed("svg-content-responsive",!0);if((o=compute_lengths(i,t,e,n)).maxreq>600){console.log("ADJUSTING SIZES"),console.log(1-o.maxreq/15e3),scalefactor=600/o.maxreq*(1-o.maxreq/15e3),n*=scalefactor,e*=scalefactor,r*=scalefactor,a*=scalefactor,s*=scalefactor;var o=compute_lengths(i,t,e,n);console.log(o.maxreq)}data=preprocess(t,o,n);var l=(600-o.maxreq)/2;drawnodes(i,data.nodes_e,15,e,l),drawnodes(i,data.nodes_f,65,e,l),drawlinks(i,data,15,65,a,r+a,l,s)}function main(){input={e:["Das","ist","ein","Beispiel","."],f:["WWW","is","an","example","."],alignment:[[0,1],[1,1],[3,2]]},drawit(input)}function createGraph(t){drawit(t)}main();